Air.Module("AirUI.UI.dragAble",function(require){function t(t,c){function p(t,c){function p(){for(var t=0;t<c.captive.length;t++){var o=c.captive[t],n=parseInt(o.style.left),a=parseInt(o.style.top);v[t]={top:a,left:n}}}function s(t){t?b={top:t.top||null,right:t.right||null,bottom:t.bottom||null,left:t.left||null}:c.ableDisable=!0}function g(e){function s(e){if(e=a(e,this),e.preventDefault(),c.ableDisable)return void g();e=e||window.event;e.target||e.srcElement;e.pageX=e.pageX||e.clientX;var l=o(e);if(c.range)var f={top:c.range.clientTop,right:c.range.offsetWidth-c.range.clientWidth-c.range.clientLeft,bottom:c.range.offsetHeight-c.range.clientHeight-c.range.clientTop,left:c.range.clientLeft};dy=l.globalY-y.globalY,dx=l.globalX-y.globalX,e.pageX||(e.pageX=e.clientX),e.pageY||(e.pageY=e.clientY);var p=x.left+dx,s=x.top+dy,h=n(t);if(c.range){var m=n(c.range),w=t.offsetLeft==h.left?p:h.left+p,B=t.offsetLeft==h.left?m.left+c.range.offsetWidth-f.right:c.range.clientWidth;c.range&&p+t.offsetWidth>B?p=t.offsetLeft==h.left?m.left+c.range.offsetWidth-t.offsetWidth-f.right:c.range.clientWidth-t.offsetWidth:c.range&&w<m.left+f.left&&(p=t.offsetLeft==h.left?m.left+f.left:0);var M=t.offsetTop==h.top?s:h.top+s,X=t.offsetTop==h.top?m.top+c.range.offsetHeight-f.bottom:c.range.clientHeight;c.range&&s+t.offsetHeight>X?s=t.offsetTop==h.top?m.top+c.range.offsetHeight-t.offsetHeight-f.bottom:c.range.clientHeight-t.offsetHeight:c.range&&M<m.top+f.top&&(s=t.offsetTop==h.top?m.top+f.top:0)}var D={top:x.top+dy,right:x.left+t.offsetWidth+dx,bottom:x.top+t.offsetHeight+dy,left:x.left+dx};b.top&&D.top<=b.top?s=b.top:b.bottom&&D.bottom>=b.bottom&&(s=b.bottom-t.offsetHeight),b.left&&D.left<=b.left?p=b.left:b.right&&D.right>=b.right&&(p=b.right-t.offsetWidth),d(t,p,s);for(var H=0;H<c.captive.length;H++){var I=c.captive[H];d(I,v[H].left+dx,v[H].top+dy)}var W=Math.atan2(dy,dx,W),Y=Math.sqrt(dy*dy+dx*dx);return Y=Math.sqrt((e.pageX-k.x)*(e.pageX-k.x)+(e.pageY-k.y)*(e.pageY-k.y)),k={x:e.pageX,y:e.pageY},c.callBack.moving({tx:dx,ty:dy,angle:W,speed:Y}),window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),!1}function g(){return e=a(e,this),e.stopBubble(),f(t,"mousemove"),f(t,"mouseup"),beacon(document).off("mousemove",s),beacon(document).off("mouseup",g),p(),c.callBack.stopMove(),!1}if(e=a(e,this),e.preventDefault(),e.stopBubble(),beacon(window).on("blur",g),c.ableDisable)return void g();var h=e.layerX||e.offsetX,m=e.layerY||e.offsetY,y=o(e);p();var x={left:t.offsetLeft,top:t.offsetTop},k={x:h,y:m};return c.callBack.startMove(),l(t,"mousemove"),beacon(document).on("mousemove",s),l(t,"mouseup"),beacon(document).on("mouseup",g),!1}c=c||{},c.position&&(t.style.position=c.position),c.callBack=c.callBack||{},c.callBack.moving=c.callBack.moving||function(){},c.callBack.stopMove=c.callBack.stopMove||function(){},c.callBack.startMove=c.callBack.startMove||function(){},c.lock=c.lock||{},c.captive=c.captive&&[].concat(c.captive)||[],c.ableDisable=c.ableDisable||!1,c.allowMove="boolean"==typeof c.allowMove?c.allowMove:!0,this.ableDisable=!1;var v=[],d=function(t){if(!c.allowMove)return function(){};var o;return o=t.v&&t.h?function(){}:t.v?function(t,o,n){t.style.left=o+"px"}:t.h?function(t,o,n){t.style.top=n+"px"}:function(t,o,n){t.style.left=o+"px",t.style.top=n+"px"}}(c.lock),b={};return beacon(t).on("mousedown",g,{preventDefault:!0,stopBubble:!0}),{stop:s}}return new p(t,c)}var o=require("AirUI.UI.mousePosition"),n=require("AirUI.UI.offset"),a=require("AirUI.event.eventObject"),l=require("AirUI.event.setCapture"),f=require("AirUI.event.releaseCapture");return function(o){var n,a={startDrag:function(a){n=t(o,a),beacon(n).on("stop",function(e,t){n.stop(t)})},stopDrag:function(t){beacon(n).on("stop",t)}};return a}});