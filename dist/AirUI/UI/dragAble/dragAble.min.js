Air.module("UI.dragAble",function(){function t(t,e){function o(t,e){function o(){for(var t=0;t<e.captive.length;t++){var o=e.captive[t],n=parseInt(o.style.left),a=parseInt(o.style.top);f[t]={top:a,left:n}}}function n(t){t?l={top:t.top||null,right:t.right||null,bottom:t.bottom||null,left:t.left||null}:e.ableDisable=!0}function a(n){function a(o){if(e.ableDisable)return void r();o=o||window.event;o.target||o.srcElement;o.pageX=o.pageX||o.clientX;var n=getMousePosition(o);if(e.range)var a={top:e.range.clientTop,right:e.range.offsetWidth-e.range.clientWidth-e.range.clientLeft,bottom:e.range.offsetHeight-e.range.clientHeight-e.range.clientTop,left:e.range.clientLeft};dy=n.globalY-g.globalY,dx=n.globalX-g.globalX,o.pageX||(o.pageX=o.clientX),o.pageY||(o.pageY=o.clientY);var p=c.left+dx,s=c.top+dy,u=offset(t);if(e.range){var v=offset(e.range),h=t.offsetLeft==u.left?p:u.left+p,b=t.offsetLeft==u.left?v.left+e.range.offsetWidth-a.right:e.range.clientWidth;e.range&&p+t.offsetWidth>b?p=t.offsetLeft==u.left?v.left+e.range.offsetWidth-t.offsetWidth-a.right:e.range.clientWidth-t.offsetWidth:e.range&&h<v.left+a.left&&(p=t.offsetLeft==u.left?v.left+a.left:0);var m=t.offsetTop==u.top?s:u.top+s,y=t.offsetTop==u.top?v.top+e.range.offsetHeight-a.bottom:e.range.clientHeight;e.range&&s+t.offsetHeight>y?s=t.offsetTop==u.top?v.top+e.range.offsetHeight-t.offsetHeight-a.bottom:e.range.clientHeight-t.offsetHeight:e.range&&m<v.top+a.top&&(s=t.offsetTop==u.top?v.top+a.top:0)}var w={top:c.top+dy,right:c.left+t.offsetWidth+dx,bottom:c.top+t.offsetHeight+dy,left:c.left+dx};l.top&&w.top<=l.top?s=l.top:l.bottom&&w.bottom>=l.bottom&&(s=l.bottom-t.offsetHeight),l.left&&w.left<=l.left?p=l.left:l.right&&w.right>=l.right&&(p=l.right-t.offsetWidth),i(t,p,s);for(var x=0;x<e.captive.length;x++){var k=e.captive[x];i(k,f[x].left+dx,f[x].top+dy)}var L=Math.atan2(dy,dx,L),X=Math.sqrt(dy*dy+dx*dx);return X=Math.sqrt((o.pageX-d.x)*(o.pageX-d.x)+(o.pageY-d.y)*(o.pageY-d.y)),d={x:o.pageX,y:o.pageY},e.callBack.moving({tx:dx,ty:dy,angle:L,speed:X}),window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),!1}function r(){return JSprite(t).removeEventListener("mousemove",a,{windowCapture:!0}),JSprite(t).removeEventListener("mouseup",r,{windowCapture:!0}),o(),e.callBack.stopMove(),!1}if(JSprite(window).addEventListener("blur",r),e.ableDisable)return void r();var p=n.layerX||n.offsetX,s=n.layerY||n.offsetY,g=getMousePosition(n);o();var c={left:t.offsetLeft,top:t.offsetTop},d={x:p,y:s};return e.callBack.startMove(),JSprite(t).addEventListener("mousemove",a,{windowCapture:!0,preventDefault:!0}),JSprite(t).addEventListener("mouseup",r,{windowCapture:!0}),!1}e=e||{},e.position&&(t.style.position=e.position),e.callBack=e.callBack||{},e.callBack.moving=e.callBack.moving||function(){},e.callBack.stopMove=e.callBack.stopMove||function(){},e.callBack.startMove=e.callBack.startMove||function(){},e.lock=e.lock||{},e.captive=e.captive&&[].concat(e.captive)||[],e.ableDisable=e.ableDisable||!1,this.ableDisable=!1;var f=[],i=function(t){var e;return e=t.v&&t.h?function(){}:t.v?function(t,e,o){t.style.left=e+"px"}:t.h?function(t,e,o){t.style.top=o+"px"}:function(t,e,o){t.style.left=e+"px",t.style.top=o+"px"}}(e.lock),l={};return JSprite(t).addEventListener("mousedown",a,{preventDefault:!0,stopBubble:!0}),{stop:n}}return new o(t,e)}return t});n function(e){var o,n={startDrag:function(n){o=t(e,n),beacon(o).on("stop",function(t,e){o.stop(e)})},stopDrag:function(t){beacon(o).on("stop",t)}};return n}});