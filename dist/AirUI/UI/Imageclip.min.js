Air.Module("AirUI.ui.Imageclip",function(t){function i(t,i){var e=document.createElement("img");return e.src=t,e.width=i,e}function e(t,i,e,n){var o=document.createElement("div");return o.style.position="static",o.style.top=n+"px",o.style.left=e+"px",o.className="cut-box",o.innerHTML='<span class="cut-line cut-line-t"></span><span class="cut-point cut-point-t"></span><span class="cut-line cut-line-r"></span><span class="cut-point cut-point-r"></span><span class="cut-line cut-line-b"></span><span class="cut-point cut-point-b"></span><span class="cut-line cut-line-l"></span><span class="cut-point cut-point-l"></span><span class="cut-point cut-point-tr"></span><span class="cut-point cut-point-br"></span><span class="cut-point cut-point-bl"></span><span class="cut-point cut-point-tl"></span>',o}function n(){var t=document.createElement("div");return t.className="cut-mask",t}function o(t,i,e,n){var o,s,f,c,h=function(){o=t.offsetWidth,s=t.offsetHeight,f=t.offsetTop,c=t.offsetLeft},l=function(){return{width:o-2,height:s-2,top:f,left:c}};e.rangeHeight=i.offsetHeight,e.rangeWidth=i.offsetWidth;var r=function(o,s){p(t.querySelector(o)).startDrag({position:"absolute",range:i,allowMove:!1,callBack:{startMove:h,moving:function(t){a(t,l(),s,e,n)}}})};r(".cut-line-t","top"),r(".cut-line-b","bottom"),r(".cut-line-r","right"),r(".cut-line-l","left"),r(".cut-point-tr","topRight"),r(".cut-point-br","bottomRight"),r(".cut-point-bl","bottomLeft"),r(".cut-point-tl","topLeft")}function a(t,i,e,n,o){var a,s,f,p,c,h,l=-1!==["topRight","bottomRight","bottomLeft","topLeft"].indexOf(e),r=-1!==["left","bottomLeft","topLeft"].indexOf(e),u=-1!==["top","topRight","topLeft"].indexOf(e),g=(-1!==["bottom","bottomLeft","bottomRight"].indexOf(e),-1!==["right","topRight","bottomRight"].indexOf(e),-1!==["left","right"].indexOf(e)),d=-1!==["top","bottom"].indexOf(e);if(g||l){var m=r?t.tx:-t.tx;a=i.width-m,s=a*n.maxHeight/n.maxWidth,c=(i.height-s)/2,h=r?m:0}if(d||l){var x=u?t.ty:-t.ty;s=i.height-x,a=s*n.maxWidth/n.maxHeight,c=u?x:0,h=(i.width-a)/2}(i.height-s)/2,(i.width-a)/2;f=i.top+c,p=i.left+h,f=0>f?0:f,p=0>p?0:p,a>=n.maxWidth||a<=n.minWidth||s>=n.maxHeight||s<=n.minHeight||f+s>n.rangeHeight||p+a>n.rangeWidth||o({top:f,left:p,width:a,height:s})}function s(t,a){function s(){p(b).startDrag({position:"absolute",range:c,callBack:{startMove:function(t){g=b.offsetWidth-2,d=b.offsetHeight-2},moving:function(t){v.translateTo({x:b.offsetLeft,y:b.offsetTop,width:g,height:d})}}})}var c=a.imgContainer,h=a.scale,l=i(t,c.offsetWidth),r=a.width*h,u=a.height*h,g=r-2,d=u-2,m=a.x||0,x=a.y||0,b=e(r,u,m,x);b.appendChild(l);var v=f(l,g,d);v.translateTo({x:m,y:x,width:g,height:d}),s(),o(b,c,{minWidth:a.minWidth*h,minHeight:a.minHeight*h,maxWidth:r,maxHeight:u},function(t){b.style.top=t.top+"px",b.style.left=t.left+"px",b.style.width=t.width+"px",b.style.height=t.height+"px",v.translateTo({x:b.offsetLeft,y:b.offsetTop,width:t.width,height:t.height})}),c.appendChild(n()),c.appendChild(b),this.getOffset=function(){var t={x:Math.floor(b.offsetLeft/h),y:Math.floor(b.offsetTop/h)};return t}}var f=t("AirUI.UI.imgCamera"),p=(t("AirUI.UI.offset"),t("AirUI.UI.dragAble"));return s});