Air.Module("AirUI.UI.Imageclip",function(require){function t(t,n){var o=document.createElement("img");return o.src=t,o.width=n,o}function n(t,n,o,a){var s=document.createElement("div");return s.style.position="static",s.style.top=a+"px",s.style.left=o+"px",s.className="cut-box",s.innerHTML='<span class="cut-line cut-line-t"></span><span class="cut-point cut-point-t"></span><span class="cut-line cut-line-r"></span><span class="cut-point cut-point-r"></span><span class="cut-line cut-line-b"></span><span class="cut-point cut-point-b"></span><span class="cut-line cut-line-l"></span><span class="cut-point cut-point-l"></span><span class="cut-point cut-point-tr"></span><span class="cut-point cut-point-br"></span><span class="cut-point cut-point-bl"></span><span class="cut-point cut-point-tl"></span>',s}function o(){var t=document.createElement("div");return t.className="cut-mask",t}function a(t,n,o,a){var h,f,p,l,g=function(){h=t.offsetWidth,f=t.offsetHeight,p=t.offsetTop,l=t.offsetLeft},d=function(){return{width:h-2,height:f-2,top:p,left:l}};o.rangeHeight=n.offsetHeight,o.rangeWidth=n.offsetWidth;var m=function(h,f){c(t.querySelector(h)).startDrag({position:"absolute",range:n,allowMove:!1,callBack:{startMove:g,moving:function(e){s(e,d(),f,o,a)}}})};m(".cut-line-t","top"),m(".cut-line-b","bottom"),m(".cut-line-r","right"),m(".cut-line-l","left"),m(".cut-point-tr","topRight"),m(".cut-point-br","bottomRight"),m(".cut-point-bl","bottomLeft"),m(".cut-point-tl","topLeft")}function s(e,t,n,o,a){var s,h,f,c,p,l,g=-1!==["topRight","bottomRight","bottomLeft","topLeft"].indexOf(n),d=-1!==["left","bottomLeft","topLeft"].indexOf(n),m=-1!==["top","topRight","topLeft"].indexOf(n),x=(-1!==["bottom","bottomLeft","bottomRight"].indexOf(n),-1!==["right","topRight","bottomRight"].indexOf(n),-1!==["left","right"].indexOf(n)),b=-1!==["top","bottom"].indexOf(n);if(x||g){var v=d?e.tx:-e.tx;s=t.width-v,h=s*o.maxHeight/o.maxWidth,p=(t.height-h)/2,l=d?v:0}if(b||g){var w=m?e.ty:-e.ty;h=t.height-w,s=h*o.maxWidth/o.maxHeight,p=m?w:0,l=(t.width-s)/2}(t.height-h)/2,(t.width-s)/2;f=t.top+p,c=t.left+l,f=0>f?0:f,c=0>c?0:c,s>o.maxWidth||s<o.minWidth||h>o.maxHeight||h<o.minHeight||f+h>o.rangeHeight||c+s>o.rangeWidth||a({top:f,left:c,width:s,height:h})}function h(s,h){function p(){c(H).startDrag({position:"absolute",range:l,callBack:{startMove:function(e){b=H.offsetWidth-2,v=H.offsetHeight-2},moving:function(e){W.translateTo({x:H.offsetLeft,y:H.offsetTop,width:b,height:v})}}})}var l=h.imgContainer,g=h.scale,d=t(s,l.offsetWidth),m=h.width*g,x=h.height*g,b=m-2,v=x-2,w=h.x||0,y=h.y||0,H=n(m,x,w,y);H.appendChild(d);var W=f(d,b,v);W.translateTo({x:w,y:y,width:b,height:v}),p(),a(H,l,{minWidth:h.minWidth*g,minHeight:h.minHeight*g,maxWidth:m,maxHeight:x},function(t){H.style.top=t.top+"px",H.style.left=t.left+"px",H.style.width=t.width+"px",H.style.height=t.height+"px",W.translateTo({x:H.offsetLeft,y:H.offsetTop,width:t.width,height:t.height})}),l.appendChild(o()),l.appendChild(H),this.getOffset=function(){var t={x:Math.floor(H.offsetLeft/g),y:Math.floor(H.offsetTop/g),width:Math.floor(H.clientWidth/g),height:Math.floor(H.clientHeight/g)};return t}}var f=require("AirUI.UI.imgCamera"),c=(require("AirUI.UI.offset"),require("AirUI.UI.dragAble"));return h});