Air.Module("AirUI.widget.Picker",function(e){function t(e,t){var n,a,i,r;return"undefined"==typeof t&&(t="x"),i=window.getComputedStyle(e,null),window.WebKitCSSMatrix?r=new WebKitCSSMatrix("none"===i.webkitTransform?"":i.webkitTransform):(r=i.MozTransform||i.transform||i.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),n=r.toString().split(",")),"x"===t&&(a=window.WebKitCSSMatrix?r.m41:16===n.length?parseFloat(n[12]):parseFloat(n[4])),"y"===t&&(a=window.WebKitCSSMatrix?r.m42:16===n.length?parseFloat(n[13]):parseFloat(n[5])),a||0}function n(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function a(e,t){n(e,t)||(e.className+=" "+t)}function i(e,t){if(n(e,t)){var a=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(a," ")}}function r(e,t){"string"!=typeof t&&(t+="ms");var n=e.style;n.webkitTransitionDuration=n.MozTransitionDuration=n.transitionDuration=t}function o(e,t){var n=e.style;n.webkitTransform=n.MozTransform=n.transform=t}function c(e,t){for(var n=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector;e;){if(n.call(e,t))return e;e=e.parentElement}return null}function s(e){function n(e,t){u.items=[];var n=u.container,a=u.wrapper;t||(n=document.createElement("div"),n.className="picker-items-col picker-items-col-center",a=document.createElement("div"),a.className="picker-items-col-wrapper");for(var i=document.createDocumentFragment(),r=0;r<e.length;r++){var o=e[r],c=document.createElement("div");c.className="picker-item",c.setAttribute("data-index",r),c.innerText=o.value||"",i.appendChild(c),u.items.push(c)}t?(a.innerHTML="",a.appendChild(i)):(a.appendChild(i),n.appendChild(a),u.container=n,u.wrapper=a)}function c(e){g||h||(e.preventDefault(),h=!0,w=k="touchstart"===e.type?e.targetTouches[0].pageY:e.pageY,y=(new Date).getTime(),V=!0,b=S=t(u.wrapper,"y"))}function s(n){k="touchmove"===n.type?n.targetTouches[0].pageY:n.pageY,g||(g=!0,b=S=t(u.wrapper,"y"),r(u.wrapper,0)),n.preventDefault();var a=k-w;S=b+a,M=void 0,f>S&&(S=f-Math.pow(f-S,.8),M="min"),S>v&&(S=v+Math.pow(S-v,.8),M="max"),o(u.wrapper,"translate3d(0,"+S+"px,0)"),u.updateItems(void 0,S,0,e.onChange),T=S-E||S,C=(new Date).getTime(),E=S}function l(t){if(!h||!g)return void(h=g=!1);h=g=!1,r(u.wrapper,""),M&&("min"===M?o(u.wrapper,"translate3d(0,"+f+"px,0)"):o(u.wrapper,"translate3d(0,"+v+"px,0)")),x=(new Date).getTime();var n,a;x-y>300?a=S:(n=Math.abs(T/(x-C)),a=S+T*e.momentumRatio),a=Math.max(Math.min(a,v),f);var i=-Math.floor((a-v)/d);a=-i*d+v,o(u.wrapper,"translate3d(0,"+parseInt(a,10)+"px,0)"),u.updateItems(i,a,""),setTimeout(function(){V=!0},100)}e=beacon.utility.merge({data:[],updateItems:!0,momentumRatio:7,updateValuesOnTouchmove:!0},e);var u=this;n(e.data);var p,d,m,f,v;u.calcSize=function(){var e,t;e=0,t=u.container.offsetHeight,p=u.wrapper.offsetHeight,d=u.items[0].offsetHeight,m=d*u.items.length,f=t/2-m+d/2,v=t/2-d/2,u.width&&(e=u.width,parseInt(e,10)===e&&(e+="px"),u.container.style.width=e+"px")},u.setValue=function(e,t,n){if(u.calcSize(),"undefined"==typeof t&&(t=""),"undefined"!=typeof e&&-1!==e){var a=-e*d+v;r(u.wrapper,t),o(u.wrapper,"translate3d(0,"+a+"px,0)"),u.updateItems(e,a,t,n)}},u.updateItems=function(n,r,c,s){"undefined"==typeof r&&(r=t(u.wrapper,"y")),"undefined"==typeof n&&(n=-Math.round((r-v)/d)),0>n&&(n=0),n>=u.items.length&&(n=u.items.length-1);var l=u.activeIndex;u.activeIndex=n;var p=u.wrapper.querySelector(".picker-selected");p&&i(p,"picker-selected");var m=u.items[n];if(m){a(m,"picker-selected"),o(m,"");+m.getAttribute("data-index");u.value=e.data[n]}s&&l!==n&&s&&s(u.value,u)},u.initVal=function(){setTimeout(function(){e.updateItems&&u.updateItems(0,v,0),u.items&&u.items.length&&(u.calcSize(),o(u.wrapper,"translate3d(0,"+v+"px,0)"),r(u.wrapper,0))},18)},u.initVal();u.refresh=function(t){e.data=t,n(t,!0),u.initVal()};var h,g,w,k,y,x,b,M,S,E,T,C,S,E,V=!0;return u.initEvents=function(e){var t=e?"remove":"add",n=t+"EventListener";u.container[n]("touchstart",c),u.container[n]("touchmove",s),u.container[n]("touchend",l)},u.destroyEvents=function(){u.initEvents(!0)},u.container.f7DestroyPickerCol=function(){u.destroyEvents()},u.initEvents(),u}function l(e){function t(t){o.cols=[];var n=document.createElement("div");n.className="picker-modal picker-columns remove-on-close",n.innerHTML=' <header class="bar bar-nav"><button class="button button-link pull-right close-picker js-confirm">确定</button><h1 class="title">'+e.title+'</h1></header><div class="picker-modal-inner picker-items"><div class="picker-center-highlight"></div></div>';for(var a=n.querySelector(".picker-items"),i=document.createDocumentFragment(),r=0;r<t.length;r++){var c=t[r],l=new s({data:c,onChange:function(){o.updateValue()}});o.cols.push(l),i.appendChild(l.container)}a.appendChild(i),document.body.appendChild(n),o.confirmBtn=n.querySelector(".js-confirm"),o.confirmBtn.addEventListener("click",o.select),o.container=n}function n(t){t.preventDefault(),p.isWeixin&&p.android&&e.inputReadOnly&&(this.focus(),this.blur()),o.opened||o.open()}function r(t){if(o.opened){var n=t.target,a=c(n,".picker-modal");e.input&&(n===e.input||a||o.close())}}var o=this;return o.cols=[],o.opened=!1,e=beacon.utility.merge({input:null,cols:[],title:"请选择",inputReadOnly:!0},e),e=e||{},o.updateValue=function(t){for(var n=[],a=0;a<o.cols.length;a++)n.push(o.cols[a].value);e.onChange&&e.onChange(n,o),n.indexOf(void 0)>=0||t&&(o.close(),o.value=n,e.onSelect&&e.onSelect(o.value,o))},o.open=function(){o.opened||(o.initialized||t(e.cols),o.opened=!0,o.container.f7Picker=o,o.container.style.display="block",o.initialized?o.value&&o.setValue(o.value,0):e.value&&o.setValue(e.value,0),setTimeout(function(){i(o.container,"modal-out"),a(o.container,"modal-in")},18)),o.initialized=!0},o.select=function(){o.updateValue(!0)},o.close=function(){o.opened&&(i(o.container,"modal-in"),a(o.container,"modal-out"),o.opened=!1)},o.destroy=function(){o.close(),e.input&&e.input.removeEventListener("click",n),o.confirmBtn.removeEventListener("click",o.select),document.removeEventListener("click",r)},o.setValue=function(t,n){for(var a=0;a<e.cols.length;a++){var i=e.cols[a],r=o.cols[a];if(i&&r){var c=t[a],s=i.indexOf(c);r.setValue(s,n)}}},e.input&&e.input.addEventListener("click",n),document.addEventListener("click",r),o}var u=navigator.userAgent,p=(u.match(/(Android);?[\s\/]+([\d.]+)?/),{isAndroid:u.match(/(Android);?[\s\/]+([\d.]+)?/),isWeixin:/MicroMessenger/i.test(u)});return l});