Air.Module("AirUI.widget.Picker",function(require){function t(t,n){var a,o,c,l;return"undefined"==typeof n&&(n="x"),c=window.getComputedStyle(t,null),window.WebKitCSSMatrix?l=new WebKitCSSMatrix("none"===c.webkitTransform?"":c.webkitTransform):(l=c.MozTransform||c.transform||c.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),a=l.toString().split(",")),"x"===n&&(o=window.WebKitCSSMatrix?l.m41:16===a.length?parseFloat(a[12]):parseFloat(a[4])),"y"===n&&(o=window.WebKitCSSMatrix?l.m42:16===a.length?parseFloat(a[13]):parseFloat(a[5])),o||0}function n(t,n){return t.className.match(new RegExp("(\\s|^)"+n+"(\\s|$)"))}function a(t,a){n(t,a)||(t.className+=" "+a)}function o(t,a){if(n(t,a)){var o=new RegExp("(\\s|^)"+a+"(\\s|$)");t.className=t.className.replace(o," ")}}function c(t,n){"string"!=typeof n&&(n+="ms");var a=t.style;a.webkitTransitionDuration=a.MozTransitionDuration=a.transitionDuration=n}function l(t,n){var a=t.style;a.webkitTransform=a.MozTransform=a.transform=n}function s(t,n){for(var a=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;t;){if(a.call(t,n))return t;t=t.parentElement}return null}function d(n){function s(t,n){f.items=[];var a=f.container,o=f.wrapper;n||(a=document.createElement("div"),a.className="picker-items-col picker-items-col-center",o=document.createElement("div"),o.className="picker-items-col-wrapper");for(var c=document.createDocumentFragment(),i=0;i<t.length;i++){var l=t[i],s=document.createElement("div");s.className="picker-item",s.setAttribute("data-index",i),s.innerText=l.value||"",c.appendChild(s),f.items.push(s)}n?(o.innerHTML="",o.appendChild(c)):(o.appendChild(c),a.appendChild(o),f.container=a,f.wrapper=o)}function d(e){x||y||(e.preventDefault(),y=!0,b=M="touchstart"===e.type?e.targetTouches[0].pageY:e.pageY,S=(new Date).getTime(),z=!0,C=V=t(f.wrapper,"y"))}function p(e){M="touchmove"===e.type?e.targetTouches[0].pageY:e.pageY,x||(x=!0,C=V=t(f.wrapper,"y"),c(f.wrapper,0)),e.preventDefault();var a=M-b;V=C+a,T=void 0,w>V&&(V=w-Math.pow(w-V,.8),T="min"),V>k&&(V=k+Math.pow(V-k,.8),T="max"),l(f.wrapper,"translate3d(0,"+V+"px,0)"),f.updateItems(void 0,V,0,n.onChange),I=V-D||V,L=(new Date).getTime(),D=V}function m(e){if(!y||!x)return void(y=x=!1);y=x=!1,c(f.wrapper,""),T&&("min"===T?l(f.wrapper,"translate3d(0,"+w+"px,0)"):l(f.wrapper,"translate3d(0,"+k+"px,0)")),E=(new Date).getTime();var t,a;E-S>300?a=V:(t=Math.abs(I/(E-L)),a=V+I*n.momentumRatio),a=Math.max(Math.min(a,k),w);var o=-Math.floor((a-k)/h);a=-o*h+k,l(f.wrapper,"translate3d(0,"+parseInt(a,10)+"px,0)"),f.updateItems(o,a,"",n.onChange),setTimeout(function(){z=!0},100)}n=beacon.utility.merge({data:[],updateItems:!0,momentumRatio:7,updateValuesOnTouchmove:!0},n);var f=this;f.data=n.data,s(n.data);var v,h,g,w,k;f.calcSize=function(){var t,n;t=0,n=f.container.offsetHeight,v=f.wrapper.offsetHeight,h=f.items[0].offsetHeight,g=h*f.items.length,w=n/2-g+h/2,k=n/2-h/2,f.width&&(t=f.width,parseInt(t,10)===t&&(t+="px"),f.container.style.width=t+"px")},f.setValue=function(t,n,a,o){if(f.calcSize(),"undefined"==typeof n&&(n=""),"undefined"!=typeof t&&-1!==t){var s=-t*h+k;c(f.wrapper,n),l(f.wrapper,"translate3d(0,"+s+"px,0)"),f.updateItems(t,s,n,a,o)}},f.updateItems=function(c,s,d,p,m){"undefined"==typeof s&&(s=t(f.wrapper,"y")),"undefined"==typeof c&&(c=-Math.round((s-k)/h)),0>c&&(c=0),c>=f.items.length&&(c=f.items.length-1);var v=f.activeIndex;f.activeIndex=c;var g=f.wrapper.querySelector(".picker-selected");g&&o(g,"picker-selected");var w=f.items[c];if(w){a(w,"picker-selected"),l(w,"");+w.getAttribute("data-index");f.value=n.data[c]}p&&(v!==c||m)&&p&&p(f.value,f)},f.initVal=function(){var t,a;if(f.data&&f.value){var o=f.data.indexOf(f.value);t=-1!==o?o:0,a=-1!==o?V:k}else t=0,a=k;n.updateItems&&f.updateItems(t,a,0),f.items&&f.items.length&&(f.calcSize(),l(f.wrapper,"translate3d(0,"+a+"px,0)"),c(f.wrapper,0))},f.initVal();f.refresh=function(t){n.data=t,f.data=n.data,s(t,!0);var a=f.data.indexOf(f.value),o=-1!==a?a:0;f.setValue(o,0)};var y,x,b,M,S,E,C,T,V,D,I,L,V,D,z=!0;return f.initEvents=function(t){var n=t?"remove":"add",a=n+"EventListener";f.container[a]("touchstart",d),f.container[a]("touchmove",p),f.container[a]("touchend",m)},f.destroyEvents=function(){f.initEvents(!0)},f.container.f7DestroyPickerCol=function(){f.destroyEvents()},f.initEvents(),f}function p(t){function n(){m.updateValue()}function c(a){m.cols=[];var o=document.createElement("div");o.className="picker-modal picker-columns remove-on-close "+t.containerClass,o.innerHTML=' <header class="bar bar-nav">'+(t.cancel?'<button class="button button-link pull-left close-picker js-cancel">'+t.cancel+"</button>":"")+(t.confirm?'<button class="button button-link pull-right close-picker js-confirm">'+t.confirm+"</button>":"")+'<h1 class="title">'+t.title+'</h1></header><div class="picker-modal-inner picker-items"><div class="picker-center-highlight"></div></div>';for(var c=o.querySelector(".picker-items"),l=document.createDocumentFragment(),i=0;i<a.length;i++){var s=a[i],p=new d({data:s,onChange:n});m.cols.push(p),l.appendChild(p.container)}c.appendChild(l),document.body.appendChild(o),m.confirmBtn=o.querySelector(".js-confirm"),m.cancelBtn=o.querySelector(".js-cancel"),m.confirmBtn&&m.confirmBtn.addEventListener("click",m.select),m.cancelBtn&&m.cancelBtn.addEventListener("click",m.close),m.container=o}function l(e){e.preventDefault(),f.isWeixin&&f.android&&t.inputReadOnly&&(this.focus(),this.blur()),m.opened||m.open()}function p(e){if(m.opened){var n=e.target,a=s(n,".picker-modal");t.input&&(n===t.input||a||m.close())}}var m=this;return m.cols=[],m.opened=!1,t=beacon.utility.merge({input:null,containerClass:"",cols:[],title:"请选择",inputReadOnly:!0},t),t=t||{},m.updateValue=function(n){for(var a=[],i=0;i<m.cols.length;i++)a.push(m.cols[i].value);t.onChange&&t.onChange(a,m),a.indexOf(void 0)>=0||n&&(m.close(),m.value=a,t.onSelect&&t.onSelect(m.value,m))},m.open=function(){m.opened||(m.initialized||c(t.cols),m.opened=!0,m.container.f7Picker=m,m.container.style.display="block",m.initialized?m.value&&m.setValue(m.value,0):t.value&&(m.value=t.value,m.setValue(t.value,0,!0)),setTimeout(function(){o(m.container,"modal-out"),a(m.container,"modal-in")},18)),m.initialized=!0},m.select=function(){m.updateValue(!0)},m.close=function(){m.opened&&(o(m.container,"modal-in"),a(m.container,"modal-out"),m.opened=!1)},m.destroy=function(){m.close(),t.input&&t.input.removeEventListener("click",l),m.confirmBtn&&m.confirmBtn.removeEventListener("click",m.select),m.cancelBtn&&m.cancelBtn.removeEventListener("click",m.close),document.removeEventListener("click",p)},m.setValue=function(a,o,c){for(var i=0;i<t.cols.length;i++){var l=m.cols[i],s=c?t.cols[i]:l.data;if(s&&l){var d=a[i],p=s.indexOf(d);l.setValue(p,o,n,!0)}}},m.refresh=function(t,n){var a=m.cols[t];a&&(a.value=m.value[t],a.refresh(n))},t.input&&t.input.addEventListener("click",l),document.addEventListener("click",p),m}var m=navigator.userAgent,f=(m.match(/(Android);?[\s\/]+([\d.]+)?/),{isAndroid:m.match(/(Android);?[\s\/]+([\d.]+)?/),isWeixin:/MicroMessenger/i.test(m)});return p});