Air.Module("AirUI.widget.Picker",function(e){function t(e,t){var n,a,i,r;return"undefined"==typeof t&&(t="x"),i=window.getComputedStyle(e,null),window.WebKitCSSMatrix?r=new WebKitCSSMatrix("none"===i.webkitTransform?"":i.webkitTransform):(r=i.MozTransform||i.transform||i.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),n=r.toString().split(",")),"x"===t&&(a=window.WebKitCSSMatrix?r.m41:16===n.length?parseFloat(n[12]):parseFloat(n[4])),"y"===t&&(a=window.WebKitCSSMatrix?r.m42:16===n.length?parseFloat(n[13]):parseFloat(n[5])),a||0}function n(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function a(e,t){n(e,t)||(e.className+=" "+t)}function i(e,t){if(n(e,t)){var a=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(a," ")}}function r(e,t){"string"!=typeof t&&(t+="ms");var n=e.style;n.webkitTransitionDuration=n.MozTransitionDuration=n.transitionDuration=t}function o(e,t){var n=e.style;n.webkitTransform=n.MozTransform=n.transform=t}function c(e,t){for(var n=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector;e;){if(n.call(e,t))return e;e=e.parentElement}return null}function l(e){function n(e,t){u.items=[];var n=u.container,a=u.wrapper;t||(n=document.createElement("div"),n.className="picker-items-col picker-items-col-center",a=document.createElement("div"),a.className="picker-items-col-wrapper");for(var i=document.createDocumentFragment(),r=0;r<e.length;r++){var o=e[r],c=document.createElement("div");c.className="picker-item",c.setAttribute("data-index",r),c.innerText=o.value||"",i.appendChild(c),u.items.push(c)}t?(a.innerHTML="",a.appendChild(i)):(a.appendChild(i),n.appendChild(a),u.container=n,u.wrapper=a)}function c(e){g||h||(e.preventDefault(),h=!0,w=k="touchstart"===e.type?e.targetTouches[0].pageY:e.pageY,y=(new Date).getTime(),V=!0,b=S=t(u.wrapper,"y"))}function l(n){k="touchmove"===n.type?n.targetTouches[0].pageY:n.pageY,g||(g=!0,b=S=t(u.wrapper,"y"),r(u.wrapper,0)),n.preventDefault();var a=k-w;S=b+a,M=void 0,f>S&&(S=f-Math.pow(f-S,.8),M="min"),S>v&&(S=v+Math.pow(S-v,.8),M="max"),o(u.wrapper,"translate3d(0,"+S+"px,0)"),u.updateItems(void 0,S,0,e.onChange),C=S-E||S,T=(new Date).getTime(),E=S}function s(t){if(!h||!g)return void(h=g=!1);h=g=!1,r(u.wrapper,""),M&&("min"===M?o(u.wrapper,"translate3d(0,"+f+"px,0)"):o(u.wrapper,"translate3d(0,"+v+"px,0)")),x=(new Date).getTime();var n,a;x-y>300?a=S:(n=Math.abs(C/(x-T)),a=S+C*e.momentumRatio),a=Math.max(Math.min(a,v),f);var i=-Math.floor((a-v)/p);a=-i*p+v,o(u.wrapper,"translate3d(0,"+parseInt(a,10)+"px,0)"),u.updateItems(i,a,"",e.onChange),setTimeout(function(){V=!0},100)}e=beacon.utility.merge({data:[],updateItems:!0,momentumRatio:7,updateValuesOnTouchmove:!0},e);var u=this;u.data=e.data,n(e.data);var d,p,m,f,v;u.calcSize=function(){var e,t;e=0,t=u.container.offsetHeight,d=u.wrapper.offsetHeight,p=u.items[0].offsetHeight,m=p*u.items.length,f=t/2-m+p/2,v=t/2-p/2,u.width&&(e=u.width,parseInt(e,10)===e&&(e+="px"),u.container.style.width=e+"px")},u.setValue=function(e,t,n,a){if(u.calcSize(),"undefined"==typeof t&&(t=""),"undefined"!=typeof e&&-1!==e){var i=-e*p+v;r(u.wrapper,t),o(u.wrapper,"translate3d(0,"+i+"px,0)"),u.updateItems(e,i,t,n,a)}},u.updateItems=function(n,r,c,l,s){"undefined"==typeof r&&(r=t(u.wrapper,"y")),"undefined"==typeof n&&(n=-Math.round((r-v)/p)),0>n&&(n=0),n>=u.items.length&&(n=u.items.length-1);var d=u.activeIndex;u.activeIndex=n;var m=u.wrapper.querySelector(".picker-selected");m&&i(m,"picker-selected");var f=u.items[n];if(f){a(f,"picker-selected"),o(f,"");+f.getAttribute("data-index");u.value=e.data[n]}l&&(d!==n||s)&&l&&l(u.value,u)},u.initVal=function(){var t,n;if(u.data&&u.value){var a=u.data.indexOf(u.value);t=-1!==a?a:0,n=-1!==a?S:v}else t=0,n=v;e.updateItems&&u.updateItems(t,n,0),u.items&&u.items.length&&(u.calcSize(),o(u.wrapper,"translate3d(0,"+n+"px,0)"),r(u.wrapper,0))},u.initVal();u.refresh=function(t){e.data=t,u.data=e.data,n(t,!0);var a=u.data.indexOf(u.value),i=-1!==a?a:0;u.setValue(i,0)};var h,g,w,k,y,x,b,M,S,E,C,T,S,E,V=!0;return u.initEvents=function(e){var t=e?"remove":"add",n=t+"EventListener";u.container[n]("touchstart",c),u.container[n]("touchmove",l),u.container[n]("touchend",s)},u.destroyEvents=function(){u.initEvents(!0)},u.container.f7DestroyPickerCol=function(){u.destroyEvents()},u.initEvents(),u}function s(e){function t(){s.updateValue()}function n(n){s.cols=[];var a=document.createElement("div");a.className="picker-modal picker-columns remove-on-close "+e.containerClass,a.innerHTML=' <header class="bar bar-nav">'+(e.cancel?'<button class="button button-link pull-left close-picker js-cancel">'+e.cancel+"</button>":"")+(e.confirm?'<button class="button button-link pull-right close-picker js-confirm">'+e.confirm+"</button>":"")+'<h1 class="title">'+e.title+'</h1></header><div class="picker-modal-inner picker-items"><div class="picker-center-highlight"></div></div>';for(var i=a.querySelector(".picker-items"),r=document.createDocumentFragment(),o=0;o<n.length;o++){var c=n[o],u=new l({data:c,onChange:t});s.cols.push(u),r.appendChild(u.container)}i.appendChild(r),document.body.appendChild(a),s.confirmBtn=a.querySelector(".js-confirm"),s.cancelBtn=a.querySelector(".js-cancel"),s.confirmBtn&&s.confirmBtn.addEventListener("click",s.select),s.cancelBtn&&s.cancelBtn.addEventListener("click",s.close),s.container=a}function r(t){t.preventDefault(),d.isWeixin&&d.android&&e.inputReadOnly&&(this.focus(),this.blur()),s.opened||s.open()}function o(t){if(s.opened){var n=t.target,a=c(n,".picker-modal");e.input&&(n===e.input||a||s.close())}}var s=this;return s.cols=[],s.opened=!1,e=beacon.utility.merge({input:null,containerClass:"",cols:[],title:"请选择",inputReadOnly:!0},e),e=e||{},s.updateValue=function(t){for(var n=[],a=0;a<s.cols.length;a++)n.push(s.cols[a].value);e.onChange&&e.onChange(n,s),n.indexOf(void 0)>=0||t&&(s.close(),s.value=n,e.onSelect&&e.onSelect(s.value,s))},s.open=function(){s.opened||(s.initialized||n(e.cols),s.opened=!0,s.container.f7Picker=s,s.container.style.display="block",s.initialized?s.value&&s.setValue(s.value,0):e.value&&(s.value=e.value,s.setValue(e.value,0,!0)),setTimeout(function(){i(s.container,"modal-out"),a(s.container,"modal-in")},18)),s.initialized=!0},s.select=function(){s.updateValue(!0)},s.close=function(){s.opened&&(i(s.container,"modal-in"),a(s.container,"modal-out"),s.opened=!1)},s.destroy=function(){s.close(),e.input&&e.input.removeEventListener("click",r),s.confirmBtn&&s.confirmBtn.removeEventListener("click",s.select),s.cancelBtn&&s.cancelBtn.removeEventListener("click",s.close),document.removeEventListener("click",o)},s.setValue=function(n,a,i){for(var r=0;r<e.cols.length;r++){var o=s.cols[r],c=i?e.cols[r]:o.data;if(c&&o){var l=n[r],u=c.indexOf(l);o.setValue(u,a,t,!0)}}},s.refresh=function(e,t){var n=s.cols[e];n&&(n.value=s.value[e],n.refresh(t))},e.input&&e.input.addEventListener("click",r),document.addEventListener("click",o),s}var u=navigator.userAgent,d=(u.match(/(Android);?[\s\/]+([\d.]+)?/),{isAndroid:u.match(/(Android);?[\s\/]+([\d.]+)?/),isWeixin:/MicroMessenger/i.test(u)});return s});