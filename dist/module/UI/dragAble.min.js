Air.Module("UI.dragAble",function(t){function e(t,e){function i(t,e){function i(){for(var t=0;t<e.captive.length;t++){var o=e.captive[t],n=parseInt(o.style.left),a=parseInt(o.style.top);s[t]={top:a,left:n}}}function r(t){t?g={top:t.top||null,right:t.right||null,bottom:t.bottom||null,left:t.left||null}:e.ableDisable=!0}function c(r){function c(f){if(f=a(f,this),f.preventDefault(),e.ableDisable)return void u();f=f||window.event;f.target||f.srcElement;f.pageX=f.pageX||f.clientX;var l=o(f);if(e.range)var i={top:e.range.clientTop,right:e.range.offsetWidth-e.range.clientWidth-e.range.clientLeft,bottom:e.range.offsetHeight-e.range.clientHeight-e.range.clientTop,left:e.range.clientLeft};dy=l.globalY-b.globalY,dx=l.globalX-b.globalX,f.pageX||(f.pageX=f.clientX),f.pageY||(f.pageY=f.clientY);var r=h.left+dx,c=h.top+dy,v=n(t);if(e.range){var d=n(e.range),y=t.offsetLeft==v.left?r:v.left+r,x=t.offsetLeft==v.left?d.left+e.range.offsetWidth-i.right:e.range.clientWidth;e.range&&r+t.offsetWidth>x?r=t.offsetLeft==v.left?d.left+e.range.offsetWidth-t.offsetWidth-i.right:e.range.clientWidth-t.offsetWidth:e.range&&y<d.left+i.left&&(r=t.offsetLeft==v.left?d.left+i.left:0);var k=t.offsetTop==v.top?c:v.top+c,B=t.offsetTop==v.top?d.top+e.range.offsetHeight-i.bottom:e.range.clientHeight;e.range&&c+t.offsetHeight>B?c=t.offsetTop==v.top?d.top+e.range.offsetHeight-t.offsetHeight-i.bottom:e.range.clientHeight-t.offsetHeight:e.range&&k<d.top+i.top&&(c=t.offsetTop==v.top?d.top+i.top:0)}var X={top:h.top+dy,right:h.left+t.offsetWidth+dx,bottom:h.top+t.offsetHeight+dy,left:h.left+dx};g.top&&X.top<=g.top?c=g.top:g.bottom&&X.bottom>=g.bottom&&(c=g.bottom-t.offsetHeight),g.left&&X.left<=g.left?r=g.left:g.right&&X.right>=g.right&&(r=g.right-t.offsetWidth),p(t,r,c);for(var D=0;D<e.captive.length;D++){var H=e.captive[D];p(H,s[D].left+dx,s[D].top+dy)}var W=Math.atan2(dy,dx,W),w=Math.sqrt(dy*dy+dx*dx);return w=Math.sqrt((f.pageX-m.x)*(f.pageX-m.x)+(f.pageY-m.y)*(f.pageY-m.y)),m={x:f.pageX,y:f.pageY},e.callBack.moving({tx:dx,ty:dy,angle:W,speed:w}),window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),!1}function u(){return r=a(r,this),r.stopBubble(),l(t,"mousemove"),l(t,"mouseup"),beacon(document).off("mousemove",c),beacon(document).off("mouseup",u),i(),e.callBack.stopMove(),!1}if(r=a(r,this),r.preventDefault(),r.stopBubble(),beacon(window).on("blur",u),e.ableDisable)return void u();var v=r.layerX||r.offsetX,d=r.layerY||r.offsetY,b=o(r);i();var h={left:t.offsetLeft,top:t.offsetTop},m={x:v,y:d};return e.callBack.startMove(),f(t,"mousemove"),beacon(document).on("mousemove",c),f(t,"mouseup"),beacon(document).on("mouseup",u),!1}e=e||{},e.position&&(t.style.position=e.position),e.callBack=e.callBack||{},e.callBack.moving=e.callBack.moving||function(){},e.callBack.stopMove=e.callBack.stopMove||function(){},e.callBack.startMove=e.callBack.startMove||function(){},e.lock=e.lock||{},e.captive=e.captive&&[].concat(e.captive)||[],e.ableDisable=e.ableDisable||!1,this.ableDisable=!1;var s=[],p=function(t){var e;return e=t.v&&t.h?function(){}:t.v?function(t,e,o){t.style.left=e+"px"}:t.h?function(t,e,o){t.style.top=o+"px"}:function(t,e,o){t.style.left=e+"px",t.style.top=o+"px"}}(e.lock),g={};return beacon(t).on("mousedown",c,{preventDefault:!0,stopBubble:!0}),{stop:r}}return new i(t,e)}var o=t("UI.mousePosition"),n=t("UI.offset"),a=t("event.eventObject"),f=t("event.setCapture"),l=t("event.releaseCapture");return function(t){var o,n={startDrag:function(n){o=e(t,n),beacon(o).on("stop",function(t,e){o.stop(e)})},stopDrag:function(t){beacon(o).on("stop",t)}};return n}});